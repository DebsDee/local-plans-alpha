{% extends "layout.html" %}

{% block pageTitle %}
  View plan data
{% endblock %}

{% block beforeContent %}
  <a class="govuk-back-link" href="/v3/">Back</a>
{% endblock %}

{% block head %}
{{ super() }}
<!-- include css and js for LeafletJS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
  integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
  crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
  integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
  crossorigin=""></script>
{% endblock %}

{% block content %}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">

      <h1 class="govuk-heading-xl">
        View plan data
      </h1>
      <p class="govuk-body-l">Explore the local plan data on this page, which has been collected and processed by the Digital Land pipeline.</p>

<div class= "govuk-grid-row">
    <div class="govuk-grid-column-full">
      <div id="map" style="height: 400px;" data-module="boundary-map-uk"></div>
    </div>
</div>

  <h3 class="govuk-heading-l govuk-!-margin-top-9 ">Facts from the data</h3>


          <div class="govuk-grid-column-one-half govuk-!-padding-left-0">
            <h2 class="govuk-heading-xl govuk-!-margin-bottom-0 ">200</h2>
            <p class="govuk-body-m">Adopted plans</p>
          </div>
          <div class="govuk-grid-column-one-half">
            <h2 class="govuk-heading-xl govuk-!-margin-bottom-0">11</h2>
            <p class="govuk-body-m">Plans in examination</p>
          </div>

          <div class="govuk-grid-column-one-half govuk-!-padding-left-0">
            <h2 class="govuk-heading-xl govuk-!-margin-bottom-0 ">1.2M</h2>
            <p class="govuk-body-m">Housing requirement total</p>
          </div>
          <div class="govuk-grid-column-one-half">
            <h2 class="govuk-heading-xl govuk-!-margin-bottom-0">9</h2>
            <p class="govuk-body-m">Local plans out of date</p>
          </div>

<div class= "govuk-grid-row">
    <div class="govuk-grid-column-full govuk-!-margin-top-9">

{% from "govuk/components/table/macro.njk" import govukTable %}

{{ govukTable({
  caption: "",
  classes:"table-size",
  firstCellIsHeader: false,
  head: [
    {
      text: "Month"
    },
    {
      text: "Adoption"
    },
    {
      text: "Examination"
    },    {
      text: "Submission"
    }
  ],
  rows: [
    [
      {
        text: "January"
      },
      {
        html: "<strong class='govuk-tag govuk-tag--blue'>34</strong>"
      },
      {
        html: "<strong class='govuk-tag govuk-tag--orange'>2</strong>"
      },
      {
      html:""
      }
    ],
    [
      {
        text: "February"
      },
      {
        html: "<strong class='govuk-tag govuk-tag--blue'>2</strong>"
      },
      {
      html:""
      },
      {
      html:""
      }
    ],
    [
      {
        text: "March"
      },
      {
        text: ""
      },
      {
      html:""
      },
      {
      html:""
      }
    ],
        [
      {
        text: "April"
      },
      {
        text: ""
      },
      {
      html:""
      },
      {
      html:""
      }
    ],
      [
      {
        text: "May"
      },
      {
        text: ""
      },
      {
      html:""
      },
      {
      html:""
      }
    ],
    [
      {
        text: "June"
      },
      {
        text: ""
      },
      {
      html:""
      },
      {
      html:""
      }
    ]
  ]
}) }}

</div>
</div>
        </div>

    <div class="govuk-grid-column-full">



    <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible">
          <h3 class="govuk-heading-l govuk-!-margin-top-9">Search the data</h3>



<div class="inline">
  <h3 class="govuk-heading-s">Plan status</h3>
<form class="form" action="/v3/plan-data" method="post">
{{ govukSelect({
  id: "status-select",
  name: "status",
  label: {
    text: ""
  },
  items: [
    {
      value: null,
      text: "Please select",
      selected: (queries.status == undefined)
    },
    {
      value: "over-5-years",
      text: "Over 5 years",
      selected: (queries.status == "over-5-years")
    },
    {
      value: "preparation",
      text: "Preparation",
      selected: (queries.status == "Preparation")
    },
    {
      value: "publication",
      text: "Publication",
      selected: (queries.status == "Publication")
    },
    {
      value: "submission",
      text: "Submission",
      selected: (queries.status == "Submission")
    },
    {
      value: "examination",
      text: "Examination",
      selected: (queries.status == "Examination")
    },
    {
      value: "adopted",
      text: "Adoption",
      selected: (queries.status == "Adopted")
    }
  ]
}) }}

</div>

<div class="inline">


  <h3 class="govuk-heading-s">Document type</h3>


{{ govukSelect({
  id: "document",
  name: "document",
  label: {
    text: ""
  },
  items: [
    {
      value: null,
      text: "Please select",
      selected: (queries.document == undefined)
    },
    {
      value: "dpd",
      text: "Development management document",
      selected: (queries.document == "dpd")
    },
    {
      value: "policy",
      text: "Policy",
      selected: (queries.document == "policy")
    }
  ]
}) }}

</div>

<div class="inline">

  <h3 class="govuk-heading-s">Plan type</h3>


{{ govukSelect({
  id: "plan-type",
  name: "plan-type",
  label: {
    text: ""
  },
  items: [
    {
      value: null,
      text: "Please select",
      selected: (queries["plan-type"] == undefined)
    },
    {
      value: "AAP",
      text: "Area Action Plan",
      selected: (queries["plan-type"] == "AAP")
    },
    {
      value: "CS",
      text: "Core strategy",
      selected: (queries["plan-type"] == "CS")
    },
    {
      value: "DM",
      text: "Development management",
      selected: (queries["plan-type"] == "DM")
    },
    {
      value: "LP",
      text: "Local plan",
      selected: (queries["plan-type"] == "LP")
    },
    {
      value: "MW",
      text: "Minerals and Waste",
      selected: (queries["plan-type"] == "MW")
    },
    {
      value: "other",
      text: "All other types",
      selected: (queries["plan-type"] == "other")
    },
    {
      value: "PR",
      text: "Partial Review",
      selected: (queries["plan-type"] == "PR")
    },
    {
      value: "SA",
      text: "Site Allocations",
      selected: (queries["plan-type"] == "SA")
    }
  ]
}) }}

</div>





<div class="inline">

      <h3 class="govuk-heading-s">Category</h3>


{{ govukSelect({
  id: "category",
  name: "category",
  label: {
    text: ""
  },
  items: [
    {
      value: null,
      text: "Please select",
      selected: (queries.category == undefined)
    },
    {
      value: "housing",
      text: "Housing",
      selected: (queries.category == "housing")
    },
    {
      value: "transport",
      text: "Transport",
      selected: (queries.category == "transport")
    }
  ]
}) }}

</div>



<div class="">

<button class="govuk-button" data-module="govuk-button" >
  Search
</button>
</div>
</form>
      <p><a href="https://docs.google.com/spreadsheets/d/e/2PACX-1vTwBvGTiQP05bLZ2Livf2Ew8CkAWkAXOfiZygZC3kZ60l2IrqCKEJFPD8oiXmb4AHJ6AV5QkcSAav2O/pubhtml" class="govuk-link">Download results CSV 11.7KB</a></p>





  <p class="govuk-!-margin-bottom-9">There are <b>200 adopted plans</b> across <b>150 local planning authorities</b>.</p>

{% from "govuk/components/table/macro.njk" import govukTable %}

{% if plans|length %}

{{ govukTable({
  caption: "",
  classes: "scroll",
  firstCellIsHeader: false,
  head: [
    {
      html: "Name",
      classes: "sort"

    },
    {
      text: "Status",
      classes: "sort"
    },
    {
      text: "Local planning authority"
    },
    {
      html: "Policy start date<span></span>",
      classes: "sort"
    },
        {
      html: "Policy end date<span></span>",
      classes: "sort"
    },
            {
      text: "Category"
    }
  ],
  rows: plans
}) }}

{% else %}

<p>Sorry, there are no results for your search</p>

{% endif %}

</div>





    <div class="govuk-grid-column-full">

<hr class="govuk-section-break govuk-section-break--xl govuk-section-break--visible">

      <h3 class="govuk-heading-l govuk-!-margin-top-9">Local planning authorities</h3>

<div class="govuk-form-group">

<form class="form" action="/v3/hackney" method="post">
        <label class="govuk-label govuk-!-font-weight-bold" for="local-authority-select">Search for planning authority</label>
          <span class="govuk-hint">E.g. East Riding of Yorkshire Council</span>
          <select class="govuk-select" name="local-authority-select" id="local-authority-select">
            <option value="">Select local authority</option>
            {% for council in councils %}
              <option value="local-authority-eng:{{council["local-authority-eng"]}}">{{ council["official-name"] }}</option>
            {% endfor %}
          </select>
<button class="govuk-button govuk-!-margin-top-5" style="display:block;" data-module="govuk-button">
  View local plan
</button>
      </form>

  </div>
</div>
</div>

{% endblock %}


{% block pageScripts %}
  <script>
const $mapElement_uk = document.querySelector('[data-module="boundary-map-uk"]');
if ($mapElement_uk) {
  // Tile layers
  var tiles = L.tileLayer("https://tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png", {
    attribution:
      '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  });
  // govuk consistent colours
  var colours = {
    lightBlue: "#1d70b8",
    darkBlue: "#003078",
    brown: "#594d00",
    yellow_brown: "#a0964e"
  };
  var latLng = L.latLng(52.561928, -1.464854);
  var map = L.map("map", {
    center: latLng,
    zoom: 6,
    layers: [tiles]
  });
  var govukStyle = {
    fillOpacity: 0.2,
    weight: 2,
    color: colours.darkBlue,
    fillColor: colours.lightBlue
  }
    var la_boundaries = new L.geoJSON();
    la_boundaries.addTo(map);
    fetch("https://opendata.arcgis.com/datasets/3a4fa2ce68f642e399b4de07643eeed3_0.geojson")
    .then((response) => {
      return response.json();
    })
    .then((data) => {
      data.features.forEach(function(d) {
        la_boundaries.addData(d);
      });
      la_boundaries.setStyle(govukStyle);
    });
}


</script>
{% endblock %}
